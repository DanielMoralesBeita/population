(function(){log=console.log;function a(){}function b(c){return c.split("/").slice(-1)[0]}function c(d){return d.split(".").slice(0,-1).join(".")}function d(e){return e.split(".").pop();}function e(f){return document.getElementById(f);}function f(g){return document.getElementsByTagName(g)[0];}function g(h){return document.createElement(h);}function h(i,j,k){var l=g("script");j=j||a;k=k||a;l.src=i;l.addEventListener("load",j);l.addEventListener("error",k);document.head.appendChild(l);}var i=Math.abs;var j=Math.acos;var k=Math.cos;var l=Math.floor;var m=Math.max;var n=Math.min;var o=Math.PI;var p=Math.pow;var q=Math.random;var r=Math.round;var s=Math.sin;var t=Math.sqrt;function u(v,w){var x=v%w;return x+(x<0)*w;}function v(w){return w*o/180;}function w(x){return x*180/o;}function x(y,z,A){return m(y,n(z,A));}function y(z,A){return l(q()*(A-z+1)+z);}function z(A,B){A*=15485863;var C=A;C*=B||1;C^=C>>2;C^=C<<5;C^=C>>11;C^=C<<17;C^=C>>23;C^=C<<31;return(C+0x80000000)/0xFFffFFff;}function A(B,C,D){B*=15485863;C*=285058399;var E=B+C;E*=D||1;E^=E>>2;E^=E<<5;E^=E>>11;E^=E<<17;E^=E>>23;E^=E<<31;return(E+0x80000000)/0xFFffFFff;}function B(C,D,E){return C*(1-E)+D*E;}function C(D,E,F){return D+F*F*(3-2*F)*(E-D);}function D(E,F){return[E[0],E[1],F];}function E(F){return[F[0],F[1]];}function F(G,H){return[G[0]+H[0],G[1]+H[1],G[2]+H[2],];}function G(H,I){return[H[1]*I[2]-H[2]*I[1],H[2]*I[0]-H[0]*I[2],H[0]*I[1]-H[1]*I[0],];}function H(I){return t(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]);}function I(J){var K=H(J);return[J[0]/K,J[1]/K,J[2]/K,];}function J(K,L){var M=s(L);var N=k(L);return[K[0],K[1]*N-K[2]*M,K[2]*N+K[1]*M,];}function K(L,M){var N=s(M);var O=k(M);return[L[0]*O+L[2]*N,L[1],L[2]*O-L[0]*N,];}function L(M,N){var O=s(N);var P=k(N);return[M[0]*P-M[1]*O,M[1]*P+M[0]*O,M[2],];}function M(){return[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1],]}function N(){this.left=0;this.top=0;this.right=0;this.bottom=0;this.width=0;this.height=0;this.rows=[];this.cellFactory=function(){return undefined;};}N.prototype={constructor:N,get:function(O,P){this.expandTo(O,P);return(this.rows[P-this.top][O-this.left]||(this.rows[P-this.top][O-this.left]=this.cellFactory(O,P)));},set:function(O,P,Q){this.expandTo(O,P);this.rows[P-this.top][O-this.left]=Q;},each:function(O){for(var P=0;P<this.rows.length;P++){var Q=this.rows[P];for(var R=0;R<Q.length;R++){var S=Q[R];if(S!==undefined){O(S,R,P);}}}},expandTo:function(O,P){if(O<this.left){this.expandLeft(O);}else if(O>=this.right){this.expandRight(O+1);}if(P<this.top){this.expandTop(P);}else if(P>=this.bottom){this.expandBottom(P+1);}},expandLeft:function(O){var P=this.left-O;if(P<=0)return;for(var Q=0;Q<this.rows.length;Q++){this.rows[Q]=Array(P).concat(this.rows[Q]);}this.left=O;this.width+=P;},expandRight:function(O){var P=O-this.right;if(P<=0)return;for(var Q=0;Q<this.rows.length;Q++){this.rows[Q]=this.rows[Q].concat(Array(P));}this.right=O;this.width+=P;},expandTop:function(O){var P=this.top-O;if(P<=0)return;this.rows=Array(P).concat(this.rows);for(var Q=0;Q<P;Q++){this.rows[Q]=Array(this.width);}this.top=O;this.height+=P;},expandBottom:function(O){var P=O-this.bottom;if(P<=0)return;this.rows=this.rows.concat(Array(P));for(var Q=0;Q<P;Q++){this.rows[this.height+Q]=Array(this.width);}this.bottom=O;this.height+=P;},};function O(P,Q,R){this.seed=P;this.zoom=Q;this.amp=R;this.samples=new N();this.samples.cellFactory=this.cellFactory.bind(this);}O.prototype={constructor:O,sample:function(P,Q){var R=P/this.zoom;var S=Q/this.zoom;var T=l(R);var U=l(S);var V=R-T;var W=S-U;var X=this.samples.get(T,U);var Y=this.samples.get(T+1,U);var Z=this.samples.get(T,U+1);var ab=this.samples.get(T+1,U+1);var bb=C;return this.amp*bb(bb(X,Y,V),bb(Z,ab,V),W);},cellFactory:function(P,Q){return A(P,Q,this.seed);},};function P(){this.layers=[new O(0,1,1),new O(1,2,2),];}P.prototype={constructor:P,sample:function(Q,R){var S=0;var T=0;for(var U=0;U<this.layers.length;U++){S+=this.layers[U].sample(Q,R);T+=this.layers[U].amp}return S/T;},};var Q={};var R={itemsToLoad:0,waitCallback:a,errorCallback:a,ready:function(S){if(this.itemsToLoad===0){S();}else{this.waitCallback=S;}return this;},error:function(S){this.errorCallback=S;return this;},onError:function(S){this.errorCallback(S);},parseUrl:function(S){var T=S.split("/").filter(Boolean);for(var U=0;U<T.length;U++){T[U]=T[U].replace(/[^a-zA-Z0-9]+/g,"_");}return T;},setItem:function(S,T){var U=this.parseUrl(S);var V=Q;var W=U[U.length-1];if(U.length>1){for(var X=0;X<U.length-1;X++){var Y=U[X];if(V[Y]===undefined){V[Y]={}}V=V[Y]}}V[W]=T;},getItem:function(S){var T=this.parseUrl(S);var U=Q;var V=T[T.length-1];if(T.length>1){for(var W=0;W<T.length-1;W++){var X=T[W];if(U[X]===undefined){return undefined;}U=U[X]}}return U[V];},image:function(S,T){var U=g("img");function V(){this.setItem(S,U);this.itemsToLoad--;T();if(this.itemsToLoad===0){var W=this.waitCallback;this.waitCallback=a;W.call(this);}}T=T||a;if(this.getItem(S)!==undefined){T();return this;}this.itemsToLoad++;U.addEventListener("load",V.bind(this));U.addEventListener("error",this.onError.bind(this,S));U.src=S;return this;},text:function(S,T){var U=new XMLHttpRequest();function V(){if(U.status===200){this.setItem(S,U.responseText);this.itemsToLoad--;T();if(this.itemsToLoad===0){var W=this.waitCallback;this.waitCallback=a;W.call(this);}}else{this.onError(S);}}T=T||a;if(this.getItem(S)!==undefined){T();return this;}this.itemsToLoad++;U.open("GET",S);U.addEventListener("load",V.bind(this));U.send();return this;},json:function(S,T){function U(){var V=this.getItem(S);var W=JSON.parse(V);this.setItem(S,W);T();}T=T||a;if(this.getItem(S)!==undefined){T();return this;}this.text(S,U.bind(this));return this;},script:function(S,T){function U(){this.setItem(S,true);this.itemsToLoad--;T();if(this.itemsToLoad===0){var V=this.waitCallback;this.waitCallback=a;V.call(this);}}T=T||a;if(this.getItem(S)!==undefined){T();return this;}this.itemsToLoad++;h(S,U.bind(this),this.onError.bind(this,S));return this;},};function S(){this.onWindowResize=this.onWindowResize.bind(this);this.onFrame=this.onFrame.bind(this);this.onRender=a;this.onResize=a;this.container=g("div");this.canvas=g("canvas");this.gl=this.canvas.getContext("webgl",{antialias:false});this.glia=this.gl.getExtension("ANGLE_instanced_arrays");this.gleiu=this.gl.getExtension("OES_element_index_uint");this.gl.enable(this.gl.BLEND);this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA);this.resize(800,600);this.setBgColor(0.0,0.0,0.0,1.0);this.container.appendChild(this.canvas);this.container.style.position="relative";this.container.style.overflow="hidden";requestAnimationFrame(this.onFrame);}S.prototype={constructor:S,attachTo:function(T){T.appendChild(this.container);return this;},attachToBody:function(){this.attachTo(document.body);return this;},detach:function(){this.container.remove();return this;},resize:function(T,U){this.width=l(T/2)*2;this.height=l(U/2)*2;this.canvas.width=this.width;this.canvas.height=this.height;this.container.style.width=this.width+"px";this.container.style.height=this.height+"px";this.gl.viewport(0,0,this.width,this.height);return this;},enableFullPageMode:function(){this.container.style.position="absolute";this.container.style.top="0";this.container.style.left="0";this.canvas.style.position="absolute";this.canvas.style.top="0";this.canvas.style.left="0";addEventListener("resize",this.onWindowResize);this.onWindowResize();return this;},disableFullPageMode:function(){this.container.style.position="relative";this.container.style.top="";this.container.style.left="";this.canvas.style.position="";this.canvas.style.top="";this.canvas.style.left="";removeEventListener("resize",this.onWindowResize);return this;},setBgColor:function(T,U,V,W){this.bgColor=[T,U,V,W];this.gl.clearColor(T,U,V,W);return this;},onWindowResize:function(){this.resize(innerWidth,innerHeight);},onFrame:function(T){this.gl.clear(this.gl.COLOR_BUFFER_BIT);this.onRender(T);requestAnimationFrame(this.onFrame);},};var T=new S();function U(V,W,X){X=X||T;var Y=X.gl;this.display=X;this.gl=X.gl;this.type=V;this.indexBuf=W||false;this.target=this.indexBuf?Y.ELEMENT_ARRAY_BUFFER:Y.ARRAY_BUFFER;this.buf=this.gl.createBuffer();this.len=0;this.data=null;this.invalidRange=[0,0];this.arraytype=(V==="byte"?Int8Array:V==="short"?Int16Array:V==="ubyte"?Uint8Array:V==="ushort"?Uint16Array:V==="float"?Float32Array:null);this.gltype=(V==="byte"?Y.BYTE:V==="short"?Y.SHORT:V==="ubyte"?Y.UNSIGNED_BYTE:V==="ushort"?Y.UNSIGNED_SHORT:V==="float"?Y.FLOAT:null);if(this.arraytype===null){throw"Error: unknown buffer type given";}}U.prototype={constructor:U,resize:function(V){var W=this.gl;data=new this.arraytype(V);if(this.data!==null){data.set(this.data.subarray(0,n(this.len,V)));}this.data=data;this.len=V;W.bindBuffer(this.target,this.buf);W.bufferData(this.target,this.data,W.STATIC_DRAW);this.invalidRange=[this.len,0];return this;},update:function(){var V=this.gl;if(this.invalidRange[0]<this.invalidRange[1]){V.bindBuffer(this.target,this.buf);V.bufferSubData(this.target,this.invalidRange[0]*this.arraytype.BYTES_PER_ELEMENT,this.data.subarray(this.invalidRange[0],this.invalidRange[1]));this.invalidRange=[this.len,0];}return this;},set:function(V,W){V=V||0;W=Array.isArray(W)?W:[W];this.data.set(W,V);this.invalidRange=[n(this.invalidRange[0],V),m(this.invalidRange[1],V+W.length),];return this;},};U.fromArray=function(V,W,X,Y){return new U(V,X,Y).resize(W.length).set(0,W);};function V(W,X,Y){Y=Y||window.display;var Z=Y.gl;this.display=Y;this.gl=Y.gl;this.vertSrc=W;this.fragSrc=X;this.texUnitCounter=0;this.indexBuf=null;this.vertShader=Z.createShader(Z.VERTEX_SHADER);this.fragShader=Z.createShader(Z.FRAGMENT_SHADER);Z.shaderSource(this.vertShader,this.vertSrc);Z.shaderSource(this.fragShader,this.fragSrc);Z.compileShader(this.vertShader);Z.compileShader(this.fragShader);if(!Z.getShaderParameter(this.vertShader,Z.COMPILE_STATUS)){throw("Error: Vertex shader compilation failed: "+Z.getShaderInfoLog(this.vertShader));}if(!Z.getShaderParameter(this.fragShader,Z.COMPILE_STATUS)){throw("Error: Fragment shader compilation failed: "+Z.getShaderInfoLog(this.fragShader));}this.prog=Z.createProgram();Z.attachShader(this.prog,this.vertShader);Z.attachShader(this.prog,this.fragShader);Z.linkProgram(this.prog);if(!Z.getProgramParameter(this.prog,Z.LINK_STATUS)){throw("A shader program linkage error occurred: "+this.gl.getProgramInfoLog(this.prog));}this.attributes={};this.uniforms={};Z.useProgram(this.prog);var ab=Z.getProgramParameter(this.prog,Z.ACTIVE_ATTRIBUTES);for(var bb=0;bb<ab;bb++){var cb=Z.getActiveAttrib(this.prog,bb);this.attributes[cb.name]={location:Z.getAttribLocation(this.prog,cb.name),type:cb.type,};}var cb=Z.getProgramParameter(this.prog,Z.ACTIVE_UNIFORMS);for(var bb=0;bb<cb;bb++){var db=Z.getActiveUniform(this.prog,bb);this.uniforms[db.name]={location:Z.getUniformLocation(this.prog,db.name),type:db.type,size:db.size,};}};V.prototype={constructor:V,setAttribute:function(W,X,Y,Z){Y=Y||0;Z=Z||0;var ab=this.gl;var bb=this.attributes[W];if(bb===undefined)return this;var cb=bb.type;var db=bb.location;var eb=(cb===ab.FLOAT?1:cb===ab.FLOAT_VEC2?2:cb===ab.FLOAT_VEC3?3:cb===ab.FLOAT_VEC4?4:0);if(eb===0){throw"Error: Attribute type not supported.";}ab.bindBuffer(X.target,X.buf);ab.enableVertexAttribArray(db);ab.vertexAttribPointer(db,eb,X.gltype,false,Y,Z);return this;},setUniform:function(W,X){X=Array.isArray(X)?X:[X];var Y=this.gl;var Z=this.uniforms[W];if(Z===undefined)return this;var ab=Z.type;var bb=Z.location;var cb=(ab===Y.FLOAT?Y.uniform1fv:ab===Y.FLOAT_VEC2?Y.uniform2fv:ab===Y.FLOAT_VEC3?Y.uniform3fv:ab===Y.FLOAT_VEC4?Y.uniform4fv:ab===Y.INT||Y.BOOL?Y.uniform1iv:ab===Y.INT_VEC2||Y.BOOL_VEC2?Y.uniform2iv:ab===Y.INT_VEC3||Y.BOOL_VEC3?Y.uniform3iv:ab===Y.INT_VEC4||Y.BOOL_VEC4?Y.uniform4iv:ab===Y.FLOAT_MAT2?Y.uniformMatrix2fv:ab===Y.FLOAT_MAT3?Y.uniformMatrix3fv:ab===Y.FLOAT_MAt4?Y.uniformMatrix4fv:null);var db=ab===Y.FLOAT_MAT2||ab===Y.FLOAT_MAT3||ab===Y.FLOAT_MAT4;if(cb===null){throw"Error: Uniform type not supported.";}Y.useProgram(this.prog);if(db){cb.call(Y,bb,false,X);}else{cb.call(Y,bb,X);}return this;},setTexture:function(W,X){var Y=this.gl;var Z=this.uniforms[W];if(Z===undefined)return this;var ab=Z.type;var bb=Z.location;if(ab!==Y.SAMPLER_2D){throw"Error: Uniform type must be sampler2D.";}this.gl.activeTexture(this.gl.TEXTURE0+this.texUnitCounter);this.gl.bindTexture(this.gl.TEXTURE_2D,X.tex);this.gl.uniform1i(bb,this.texUnitCounter);this.texUnitCounter++;return this;},resetTextures:function(){this.texUnitCounter=0;return this;},setIndices:function(W){var X=this.gl;this.indexBuf=W;X.bindBuffer(X.ELEMENT_ARRAY_BUFFER,W.buf);},drawTriangleStrip:function(){var W=this.gl;if(this.indexBuf!==null){W.drawElements(W.TRIANGLE_STRIP,this.indexBuf.len,this.indexBuf.gltype,0);}else{W.drawArrays(W.TRIANGLE_STRIP,0,4);}},};Q.shaders=Q.shaders||{};R.shader=function(W,X,Y,Z,ab){X=Array.isArray(X)?X:[X];Y=Array.isArray(Y)?Y:[Y];var bb=X.length;var cb=Y.length;var db=null;var eb=null;function fb(){bb--;if(bb===0){db="precision highp float;precision highp int;";db+=this.combineTextFromUrls(X);if(db!==null&&eb!==null){Q.shaders[W]=new V(db,eb,ab);Z();}}}function gb(){cb--;if(cb===0){eb="precision highp float;precision highp int;";eb+=this.combineTextFromUrls(Y);if(db!==null&&eb!==null){Q.shaders[W]=new V(db,eb,ab);Z();}}}Z=Z||a;ab=ab||T;if(Q.shaders[W]){Z();return this;}for(var hb=0;hb<X.length;hb++){var ib=X[hb];this.text(ib,fb.bind(this));}for(var hb=0;hb<Y.length;hb++){var ib=Y[hb];this.text(ib,gb.bind(this));}return this;};R.combineTextFromUrls=function(W){var X="";for(var Y=0;Y<W.length;Y++){var Z=W[Y];var ab=this.getItem(Z);X+=ab;}return X;};function W(X){X=X||T;var Y=X.gl;this.display=X;this.gl=X.gl;this.tex=this.gl.createTexture();Y.bindTexture(Y.TEXTURE_2D,this.tex);Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.NEAREST);Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.NEAREST);};W.prototype={constructor:W,fromImage:function(X){var Y=this.gl;Y.bindTexture(Y.TEXTURE_2D,this.tex);Y.texImage2D(Y.TEXTURE_2D,0,Y.RGBA,Y.RGBA,Y.UNSIGNED_BYTE,X);return this;},};R.texture=function(X,Y,Z){function ab(){var bb=this.getItem(X);var cb=new W(Z).fromImage(bb);this.setItem(X,cb);Y();}Y=Y||a;Z=Z||T;if(this.getItem(X)!==undefined){Y();}this.image(X,ab.bind(this));return this;};var X=t(3)/2;var Y=j(1/t(3));var Z=t(2/3);var ab=1/t(3);var bb=1/3;var cb=[0,0,-1];cb=J(cb,v(-45));cb=L(cb,v(30));var db=32;var eb=db;var fb=db*2;var gb=eb+1;var hb=fb+1;var ib=hb*gb;var jb=db*2;var kb=db*2;var lb=kb*jb;var mb=(jb+2+2)*kb-2;function nb(ob){return[ob[0]-1,ob[1]];}function ob(pb){return[pb[0]+1,pb[1]];}function pb(qb){return[qb[0]-1+u(qb[1],2),qb[1]-1,];}function qb(rb){return[rb[0]+u(rb[1],2),rb[1]-1,];}function rb(sb){return[sb[0]-1+u(sb[1],2),sb[1]+1,];}function sb(tb){return[tb[0]+u(tb[1],2),tb[1]+1,];}function tb(ub){return ub[0]+ub[1]*gb;}function ub(vb){return[l(vb[0]/eb),l(vb[1]/fb),];}function vb(wb){return[u(wb[0],eb),u(wb[1],fb),];}function wb(xb,yb){return[xb[0]*eb+yb[0],xb[1]*fb+yb[1],];}function xb(yb){return[yb[0]+0.5*u(yb[1],2),yb[1]*X,yb[2]*bb,];}function yb(zb){return[T.width/2+camera.zoom*(-camera.pos[0]+zb[0]),T.height/2+camera.zoom*(-camera.pos[1]+zb[1]*ab-zb[2]*Z),];}function zb(Ab){return yb(xb(Ab));}mapgen={perlin:new P(),height:function(Ab,Bb){return this.perlin.sample(Ab,Bb)*3;},terra:function(Ab,Bb){return l(this.perlin.sample(Ab,Bb)*2)+1;},};function Ab(Bb,Cb){this.map=Bb;this.pos=Cb;this.heights=new U("ubyte").resize(ib);this.terra=new U("ubyte").resize(ib);this.normals=new U("float").resize(ib*3);for(var Db=0;Db<hb;Db++){for(var Eb=0;Eb<gb;Eb++){var Fb=tb([Eb,Db]);var Gb=wb(this.pos,[Eb,Db]);this.heights.set(Fb,Bb.gen.height(Gb[0],Gb[1]));this.terra.set(Fb,Bb.gen.terra(Gb[0],Gb[1]));}}}(function(){this.draw=function(){var Bb=this.map.shader;this.heights.update();this.normals.update();this.terra.update();Bb.setAttribute("aHeight",this.heights);Bb.setAttribute("aNormal",this.normals);Bb.setAttribute("aTerra",this.terra);Bb.setUniform("uChunkCoord",this.pos);Bb.drawTriangleStrip();};this.updateNormals=function(){for(var Bb=0;Bb<hb;Bb++){for(var Cb=0;Cb<gb;Cb++){var Db=tb([Cb,Bb]);var Eb=wb(this.pos,[Cb,Bb]);var Fb=[map.getVertex(nb(Eb)),map.getVertex(pb(Eb)),map.getVertex(qb(Eb)),map.getVertex(ob(Eb)),map.getVertex(sb(Eb)),map.getVertex(rb(Eb)),];var Gb=[G(Fb[0],Fb[1]),G(Fb[1],Fb[2]),G(Fb[2],Fb[3]),G(Fb[3],Fb[4]),G(Fb[4],Fb[5]),G(Fb[5],Fb[0]),];var Hb=[0,0,0];Gb.forEach(function(Ib){Hb=F(Hb,Ib);});Hb=I(Hb);this.normals.set(Db*3,Hb);}}};}).call(Ab.prototype);function Bb(){this.gen=mapgen;this.chunks=new N();this.shader=Q.shaders.map;this.mapCoords=new U("short").resize(ib*2);this.indices=new U("ushort",true).resize(mb);for(var Cb=0;Cb<hb;Cb++){for(var Db=0;Db<gb;Db++){this.mapCoords.set(tb([Db,Cb])*2,[Db,Cb]);}}for(var Cb=0,i=0;Cb<kb;Cb++){var Db=Cb%2===0;var Eb=!Db;for(var Fb=0;Fb<jb;Fb++){var Gb=Db&&Fb%2==0||Eb&&Fb%2==1;var Hb=!Gb;this.indices.set(i++,(Cb+Hb)*gb+l(Fb/2));if(Fb==0&&Cb>0){this.indices.set(i++,this.indices.data[i-2]);}}this.indices.set(i++,(Cb+1+Eb)*gb-1);this.indices.set(i++,(Cb+1+Db)*gb-1);if(Cb<kb-1){this.indices.set(i++,this.indices.data[i-2]);}}this.mapCoords.update();this.indices.update();}Bb.prototype={constructor:Bb,getHeight:function(Cb){var Db=ub(Cb);var Eb=vb(Cb);var Fb=this.getChunk(Db);var Gb=tb(Eb);return Fb===undefined?0:Fb.heights.data[Gb];},getVertex:function(Cb){return xb(D(Cb,this.getHeight(Cb)));},draw:function(){this.shader.setAttribute("aMapCoord",this.mapCoords);this.shader.setIndices(this.indices);this.shader.setUniform("uChunkSize",db);this.shader.setUniform("uScreenSize",[T.width,T.height]);this.shader.setUniform("uZoom",camera.zoom);this.shader.setUniform("uCameraPos",camera.pos);this.shader.setUniform("uSun",cb);this.shader.resetTextures();this.shader.setTexture("uTex",Q.gfx.terrain_png);this.chunks.each(function(Cb,Db,Eb){Cb.draw();});},getChunk:function(Cb){return this.chunks.get(Cb[0],Cb[1]);},setChunk:function(Cb,Db){this.chunks.set(Cb[0],Cb[1],Db);},addChunk:function(Cb){if(this.getChunk(Cb)===undefined){var Db=new Ab(this,Cb);this.setChunk(Cb,Db);Db.updateNormals();var Eb=this.getChunk([Cb[0]-1,Cb[1]]);if(Eb)Eb.updateNormals();}},};function Cb(Db,Eb,Fb,Gb){Gb=Gb||T;this.display=Gb;this.div=g("div");this.div.style.position="absolute";this.display.container.appendChild(this.div);this.setPos(0,0);this.setText(Db||"New Label");}Cb.prototype={constructor:Cb,setText:function(Db){this.text=Db;this.div.innerHTML=Db;return this;},setFont:function(Db){this.div.style.fontFamily=Db;return this;},setColor:function(Db){this.div.style.color=Db;return this;},setPos:function(Db,Eb){this.pos=[Db,Eb];this.div.style.left=Db+"px";this.div.style.top=Eb+"px";return this;},};function Db(){this.pos=[0,0];this.zoom=32;}Db.prototype={constructor:Db,move:function(Eb,Fb){this.pos[0]+=Eb/this.zoom;this.pos[1]+=Fb/this.zoom;},};function Eb(Fb){Fb=Fb||T;this.display=Fb;this.elm=Fb.container;this.moving=false;this.elm.addEventListener("mousemove",this.onMouseMove.bind(this));this.elm.addEventListener("mousedown",this.onMouseDown.bind(this));this.elm.addEventListener("mouseup",this.onMouseUp.bind(this));this.elm.addEventListener("wheel",this.onMouseWheel.bind(this));}Eb.prototype={constructor:Eb,updateMouse:function(Fb){var Gb=this.elm.getBoundingClientRect();this.mouseX=Fb.clientX-Gb.left;this.mouseY=Fb.clientY-Gb.top;this.mouseRelX=Fb.movementX;this.mouseRelY=Fb.movementY;},onMouseMove:function(Fb){this.updateMouse(Fb);if(this.moving){camera.move(this.mouseRelX,this.mouseRelY);}var Gb=((this.mouseY-T.height/2)/camera.zoom+camera.pos[1])*2;var Hb=l(Gb);var Ib=(this.mouseX-T.width/2)/camera.zoom+camera.pos[0]-i(Hb%2)*0.5;var Jb=r(Ib);var Kb=Ib<Jb;var Lb=i(Hb%2)===1;var Mb=1000000;var Nb=1000000;var Ob=1000000;for(var Pb=0;Pb<6;Pb++){var Qb=i((Hb+Pb)%2)===1;var Rb=Lb?!Qb*!Kb*+1:Qb*Kb*-1;var Sb=Jb+Rb;var Tb=Hb+Pb;var Ub=zb([Sb,Tb,map.getHeight([Sb,Tb])]);var Vb=p(this.mouseX-Ub[0],2)+p(this.mouseY-Ub[1],2);labels[Pb].setPos(Ub[0],Ub[1]);if(Vb<Mb){Mb=Vb;Nb=Sb;Ob=Tb;}}var Qb=zb([Nb,Ob,map.getHeight([Nb,Ob])]);labels[0].setPos(Qb[0],Qb[1]);labels[1].setPos(0,0);labels[2].setPos(0,0);labels[3].setPos(0,0);labels[4].setPos(0,0);labels[5].setPos(0,0);},onMouseDown:function(Fb){this.updateMouse(Fb);this.moving=true;T.canvas.requestPointerLock();},onMouseUp:function(Fb){this.updateMouse(Fb);this.moving=false;document.exitPointerLock();},onMouseWheel:function(Fb){this.updateMouse(Fb);if(Fb.deltaY>0){this.onMouseWheelDown();}else{this.onMouseWheelUp();}},onMouseWheelDown:function(){camera.zoom/=1.25;},onMouseWheelUp:function(){camera.zoom*=1.25;},};var Fb;var Gb;R.texture("gfx/terrain.png").shader("map",["shaders/utils.glslv","shaders/map.vert.glslv"],["shaders/map.frag.glslf"],).shader("mapcoord",["shaders/utils.glslv","shaders/mapcoord.vert.glslv"],["shaders/utils.glslv","shaders/mapcoord.frag.glslf"],).ready(Fb);function Fb(){T.attachToBody().enableFullPageMode().setBgColor(1,1,1,1);camera=new Db();map=new Bb();input=new Eb();var Hb=2;for(var Ib=-Hb;Ib<=Hb;Ib++){for(var Jb=-Hb;Jb<=Hb;Jb++){map.addChunk([Ib,Jb]);}}labels=[new Cb("A").setColor("#f00").setPos(16,16),new Cb("B").setColor("#0f0").setPos(16,16),new Cb("C").setColor("#00f").setPos(16,16),new Cb("D").setColor("#0ff").setPos(16,16),new Cb("E").setColor("#f0f").setPos(16,16),new Cb("F").setColor("#ff0").setPos(16,16),];T.onRender=Gb;}function Gb(){map.draw();}})();
